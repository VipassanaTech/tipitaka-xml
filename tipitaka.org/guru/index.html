<!DOCTYPE html>

<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> 
    <meta http-equiv="X-UA-Compatible" content="IE=edge"> 
    <meta name="viewport" content="width=device-width, initial-scale=1">

	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.2.1/themes/default/style.min.css" />
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.2.1/jstree.min.js"></script>
        
    <!-- Stylesheet for showing hamburger icon in mobile mode -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <!-- Stylesheet for Tree site -->
	<link rel="stylesheet" href="./css/tipitaka-latn.css" />

    <!-- Stylesheet for Top Nav bar -->
    <link href="../css/tipistyles.css" rel="stylesheet">    

    <title>CSCD Tipiṭaka (Gurmukhi)</title>  
    <link rel="icon" type="image/x-icon" href="../favicon.ico">
    <style>

        
    </style>

    <!-- Tree display code-->
	<script>
		function scrollToTop() { 
		   window.scrollTo(0, 0); 
		}
	
		$(document).ready(function(){
		var jtree = $('#tree').jstree({
            'plugins': ['types'], // Enable the types plugin
            'core' : {
                'data' : {'url': 'tree.json'},
                'expand_selected_onload' : true,
                'responsive': true
            },
            'types': { 
                'leaf': { // Leaf node type
                    'valid_children': [], // No children allowed for files
                    'icon':  "./images/xp/file.png"
                },
                'default': {
                    //'valid_children': 'all', // Allow any type of children for folders
                    'icon': "./images/xp/folder.png",
                    'max_depth': 5 // Limit the depth of the tree hierarchy to 2 levels
                }
            },
            'check_callback': true, // Enable custom callbacks for modifying the tree behavior
		}).ready(function(){
			var nid = window.location.hash.substr(1);
			if (nid)
			{
				setTimeout(
				  function() 
				  {
					t = $("#tree").jstree(true); 
					t.deselect_all();
					t.select_node(nid);
				  }, 1000);
			}
		});

        // Custom callback for determining valid children for nodes
        jtree.on('check_callback', function(operation, node, node_parent, node_position, more) {
            if (operation === 'copy_node' || operation === 'move_node') {
                // Disallow copying or moving into a 'file' node (leaf node)
                if (node_parent.type === 'file') {
                    return false;
                }
            }
            return true;
        });

        $(document).ready(function () {
            $("#plugins4").jstree({
                "plugins" : [ "search" ]
            });
            var to = false;
            $('#plugins4_q').keyup(function () {
                if(to) { clearTimeout(to); }
                to = setTimeout(function () {
                var v = $('#plugins4_q').val();
                $('#plugins4').jstree(true).search(v);
                }, 250);
            });
            
        });
	
		$('#tree')
			.on("changed.jstree", function (e, data) {
				if(data.selected.length) {
					var s = data.instance.get_node(data.selected[0]).id;
                    console.log('node id=',s);
                    //var lnk = $( s+"_anchor").attr('href');    
                    var lnk = $( "#"+s+"_anchor").attr('href');
					//alert('The selected node is: ' + lnk);
					console.log("lnk is "+lnk);
                    if (lnk != '#')  // leaf so shows the content
					{
						window.location.hash = s;
						$("#t-content").load(lnk);
						setTimeout(
						  function() 
						  {
							$("html").animate({scrollTop:01}, 00);
								return false;
						  }, 0);
					}
					else
                    // open nodes
					{
                        console.log("data.selected[0]", data.selected[0])
						data.instance.open_node(data.selected[0],false, false);
					}
				}
			})
		});
	</script>




</head>    

<body> 
    <div class="flex-wrapper">
        <!-- Top nav bar from topnav.html imported via JScript (see below) -->
        <div class="nav-wrapper">
            <div class="topnav" id="myTopnav"></div>
        </div>

        <!-- Main Heading -->
        <div class="header">
            <div class="centered">
                <img src="../images/dhamma-wheel.svg" class="wheel" alt="Dhamma wheel" />
                <h1 class="display-3">Pāḷi Tipiṭaka</h1>
            </div>
            <hr class="hrstyle">  
        </div>   


        <!-- Page New Content-->
        <!-- Return to Top button -->
        <button onclick="topFunction()" id="myBtn" title="Go to top">Top</button>
        
        <div class="bodycontainer" id="bodycontainer">
            <div class="sidebar" id="tree"></div>
    
            <div class="separator" id="separator"></div>
    
            <div class="content " id="t-content"></div>
        </div>


        <!-- Page footer -->
        <div class="container">
            <footer>
            </footer>   
        </div>
    </div>

    <!-- body code goes here -->  
    <script>
        function myFunction() {
            var x = document.getElementById("myTopnav");
            if (x.className === "topnav") {
            x.className += " responsive";
            } else {
            x.className = "topnav";
            }
        }
    </script>   

    <!-- Return to Top button code-->
    <script>
        // Get the button
        let mybutton = document.getElementById("myBtn");
        
        // When the user scrolls down 20px from the top of the document, show the button
        window.onscroll = function() {scrollFunction()};
        
        function scrollFunction() {
            if (document.body.scrollTop > 300 || document.documentElement.scrollTop > 300) {
                mybutton.style.display = "block";
            } else {
                mybutton.style.display = "none";
            }
        }
        
        // When the user clicks on the button, scroll to the top of the document
        function topFunction() {
        document.body.scrollTop = 0;
        document.documentElement.scrollTop = 0;
        }
    </script>

    <!--Resizable splitter code-->
    <script>
        window.addEventListener("DOMContentLoaded", function() {
            var separator = document.getElementById("separator");
            var sidebar = document.getElementById("tree");
            var container = document.getElementById("bodycontainer");
    
            // Check screen width to determine whether to use mouse or touch events
            var isMobile = window.innerWidth <= 768;
    
            if (isMobile) {
                separator.addEventListener("touchstart", function(e) {
                    e.preventDefault();
                    var touch = e.touches[0];
                    separator.addEventListener("touchmove", resizeSidebar);
                    separator.addEventListener("touchend", stopResizeSidebar);
                });
            } else {
                separator.addEventListener("mousedown", function(e) {
                    e.preventDefault();
                    document.addEventListener("mousemove", resizeSidebar);
                    document.addEventListener("mouseup", stopResizeSidebar);
                });
            }
    
            function showhideseparator() {
                if (separator.length < 5) {
                    separator.style.display = "none";
                } else {
                    separator.style.display = "block";
                }
            }
    
            function resizeSidebar(e) {
                var xPosition = isMobile ? e.touches[0].clientX : e.clientX;
                var sidebarWidth = xPosition - container.offsetLeft;
                sidebar.style.width = sidebarWidth + "px";
            }
    
            function stopResizeSidebar() {
                if (isMobile) {
                    separator.removeEventListener("touchmove", resizeSidebar);
                    separator.removeEventListener("touchend", stopResizeSidebar);
                } else {
                    document.removeEventListener("mousemove", resizeSidebar);
                    document.removeEventListener("mouseup", stopResizeSidebar);
                }
            }
        });
    </script>
    
    <script defer src="../js/topnavscript.js"></script>    
         
</body>
</html>